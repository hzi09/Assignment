{% extends "base.html" %}

{% block content %}

    <h1>ê¸€ ìƒì„¸ í˜ì´ì§€</h1>
    <!-- ê¸€ ì •ë³´ -->
    <h2>{{ post.title }}</h2>
    <p>ì‘ì„±ì : <a href="{% url 'users:user_profile' post.author.username %}" >{{ post.author.username }}</a> | ì‘ì„±ì¼ì‹œ: {{ post.created_at|date:'Y-m-d H:i:s' }} | ìˆ˜ì •ì¼ì‹œ: {{ post.updated_at|date:'Y-m-d H:i:s' }}</p>
    <p>â™¥ï¸ì¢‹ì•„ìš” {{ post.like_users.count }} | ğŸ—¨ï¸ëŒ“ê¸€ {{ comments|length }}</p>

    <hr>
    <!-- ê¸€ ë³¸ë¬¸ -->
    <p>{{ post.content }}</p>

    <hr>

    <!-- ì¢‹ì•„ìš” -->
    <form action="{% url 'posts:like' post.pk %}" method="POST">
        {% csrf_token %}
        {% if request.user in post.like_users.all %}
            <input type="submit" value="ì¢‹ì•„ìš” ì·¨ì†Œ">
        {% else %}
            <input type="submit" value="â™¥ï¸ ì¢‹ì•„ìš”">
        {% endif %}
    </form>
    <hr>

    <!-- ê¸€ ì‘ì„±ìì—ê²Œë§Œ ìˆ˜ì •í•˜ê¸°, ì‚­ì œí•˜ê¸° ë³´ì—¬ì£¼ê¸° -->
    {% if post.author == request.user %}
        <form action="{% url 'posts:post_update' post.pk %}" style="display: inline;">
            <button type="submit">ìˆ˜ì •í•˜ê¸°</button>
        </form>

        <form action="{% url 'posts:post_delete' post.pk %}" method="post" style="display: inline;">
            {% csrf_token %}
            <button type="submit">ì‚­ì œí•˜ê¸°</button>
        </form>
    <hr>
    {% endif %}

    <!-- ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°  -->
    <a href="{% url 'posts:post_list' %}">
        <button>ê¸€ ëª©ë¡ ë³´ê¸°</button>
    </a>
    <hr>

    <!-- ëŒ“ê¸€ ì‘ì„±í•˜ê¸°-->
    <h3>ëŒ“ê¸€ {{ comments|length }}ê°œ</h3>
        <form action="{% url 'posts:comment_create' post.pk %}" method="POST">
            {% csrf_token %}
            {{ comment_form.as_p }}
        <input type="submit" value="ì‘ì„±">
    </form>

    <!--ëŒ“ê¸€ ëª©ë¡ -->
    {% for comment in comments %}
        <p>{{ comment.content }} | ì‘ì„±ì : <strong>{{comment.comment_user}}</strong> | {{ comment.created_at|date:'Y-m-d H:i:s' }}</p>
            
            <!--ëŒ“ê¸€ ì‚­ì œí•˜ê¸°-->
            <form action="{% url 'posts:comment_delete' post.pk comment.pk%}" method="POST" style="display: inline;">
                {% csrf_token %}
                <input type="submit" value="ì‚­ì œ">
            </form>

            <!-- ìˆ˜ì • ë²„íŠ¼ -->
            {% if comment.comment_user == request.user %}
                <form action="{% url 'posts:post_detail' pk=post.pk %}" method="get" style="display: inline;">
                    <button type="submit" name="edit_comment" value="{{ comment.pk }}">ìˆ˜ì •</button>
                </form>
            {% endif %}

            <!-- ìˆ˜ì • í¼ -->
            {% if edit_comment == comment.pk %}
                <form action="{% url 'posts:comment_update' pk=post.pk comment_pk=comment.pk %}" method="post">
                    {% csrf_token %}
                    <input type="text" name="content" value="{{ comment.content }}" required>
                    <button type="submit">ìˆ˜ì • ì™„ë£Œ</button>
                </form>
            {% endif %}
        <hr>
{% endfor %}

{% endblock content %}
